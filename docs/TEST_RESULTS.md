# PueueWrapper æ–°åŠŸèƒ½æ¸¬è©¦çµæœå ±å‘Š

## æ¸¬è©¦æ¦‚è¿°

å·²æˆåŠŸå®Œæˆ PueueWrapper æ‰€æœ‰æ–°åŠŸèƒ½çš„å…¨é¢æ¸¬è©¦ï¼ŒåŒ…æ‹¬ï¼š
- ç•°æ­¥åŒ…è£å™¨ (PueueWrapper)
- åŒæ­¥åŒ…è£å™¨ (PueueWrapperSync) 
- FastAPI æ¥å£ (api.py)

## âœ… æ¸¬è©¦çµæœç¸½è¦½

### 1. ç•°æ­¥åŒ…è£å™¨æ¸¬è©¦ (test_async_features.py)

**ç‹€æ…‹ï¼šå…¨éƒ¨é€šé âœ…**

```
âœ… å‰µå»ºçµ„: Group 'test-group' created successfully
âœ… è¨­ç½®ä¸¦è¡Œä»»å‹™æ•¸: Set parallel tasks to 2 for group 'test-group'
âœ… æ·»åŠ é«˜å„ªå…ˆç´šä»»å‹™: 5
âœ… æ·»åŠ ä¾è³´ä»»å‹™: 6
âœ… æ·»åŠ æš«å­˜ä»»å‹™: 7
âœ… çµ„ 'default': ç‹€æ…‹=Running, ä¸¦è¡Œä»»å‹™æ•¸=1
âœ… çµ„ 'sync-test': ç‹€æ…‹=Running, ä¸¦è¡Œä»»å‹™æ•¸=1
âœ… çµ„ 'test-group': ç‹€æ…‹=Running, ä¸¦è¡Œä»»å‹™æ•¸=2
âœ… ç•¶å‰ä»»å‹™: ['2', '4', '5', '6', '7']
âœ… é‡å•Ÿä»»å‹™: Restarted tasks: [2]
âœ… æ¸…ç†ä»»å‹™: Cleaned tasks in group 'test-group'
âœ… é‡ç½®çµ„: Reset queue for groups: ['test-group']
âœ… ç§»é™¤çµ„: Group 'test-group' removed successfully
âœ… ç²å–ä»»å‹™æ—¥èªŒ: ä»»å‹™ 2 - echo 'Delayed task'
âœ… ç²å–çµæ§‹åŒ–æ—¥èªŒ: 1 å€‹ä»»å‹™
```

### 2. åŒæ­¥åŒ…è£å™¨æ¸¬è©¦ (test_sync_features.py)

**ç‹€æ…‹ï¼šå…¨éƒ¨é€šé âœ…**

```
âœ… è¨­ç½®ä¸¦è¡Œä»»å‹™æ•¸: Set parallel tasks to 3 for group 'sync-test'
âœ… æ·»åŠ ä»»å‹™: 9
âœ… çµ„ 'default': Running, ä¸¦è¡Œ=1
âœ… çµ„ 'sync-test': Running, ä¸¦è¡Œ=3
âœ… ç¸½ä»»å‹™æ•¸: 5
âœ… æ¸…ç†ä»»å‹™: Cleaned tasks in group 'sync-test'
âœ… é‡ç½®çµ„: Reset queue for groups: ['sync-test']
âœ… ç§»é™¤çµ„: Group 'sync-test' removed successfully
```

### 3. FastAPI æ¥å£æ¸¬è©¦

**ç‹€æ…‹ï¼šå…¨éƒ¨é€šé âœ…**

```
âœ… ç²å–çµ„åˆ—è¡¨: {"default": {"status": "Running", "parallel_tasks": 1}}
âœ… å‰µå»ºçµ„: {"success": true, "message": "Group 'api-test' created successfully"}
âœ… æ·»åŠ ä»»å‹™: "9"
âœ… ç²å–ç‹€æ…‹: å®Œæ•´çš„ JSON ç‹€æ…‹ä¿¡æ¯
âœ… é‡ç½®çµ„: {"success": true, "message": "Reset queue for groups: ['api-test']"}
âœ… åˆªé™¤çµ„: {"success": true, "message": "Group 'api-test' removed successfully"}
```

## ğŸ”§ è§£æ±ºçš„å•é¡Œ

### 1. Pydantic æ¨¡å‹é©—è­‰å•é¡Œ
- **å•é¡Œ**: Stashed ç‹€æ…‹ä½¿ç”¨ `enqueue_at` è€Œé `enqueued_at`
- **è§£æ±º**: æ·»åŠ  `model_validator` è™•ç†å…©ç¨®å­—æ®µå

### 2. GroupStatus æšèˆ‰ä¸å®Œæ•´
- **å•é¡Œ**: ç¼ºå°‘ `Reset` ç‹€æ…‹
- **è§£æ±º**: æ·»åŠ  `RESET = "Reset"` åˆ°æšèˆ‰

### 3. Reset å‘½ä»¤åƒæ•¸éŒ¯èª¤
- **å•é¡Œ**: ä½¿ç”¨ `--group` è€Œé `--groups`
- **è§£æ±º**: ä¿®æ­£ç‚º `--groups` ä¸¦æ”¯æŒå¤šçµ„é‡ç½®

## ğŸ“Š åŠŸèƒ½è¦†è“‹åº¦

### å¢å¼·çš„ add_task åŠŸèƒ½
- âœ… working_directory æ”¯æŒ
- âœ… group æŒ‡å®š
- âœ… priority è¨­ç½®
- âœ… after (ä¾è³´ä»»å‹™) æ”¯æŒ
- âœ… delay å»¶é²åŸ·è¡Œ
- âœ… immediate ç«‹å³åŸ·è¡Œ
- âœ… stashed æš«å­˜ç‹€æ…‹
- âœ… escape è½‰ç¾©æ”¯æŒ

### Group ç®¡ç†åŠŸèƒ½
- âœ… get_groups() - ç²å–æ‰€æœ‰çµ„
- âœ… add_group() - å‰µå»ºæ–°çµ„
- âœ… remove_group() - åˆªé™¤çµ„
- âœ… set_group_parallel() - è¨­ç½®ä¸¦è¡Œä»»å‹™æ•¸

### ä»»å‹™æ§åˆ¶åŠŸèƒ½
- âœ… remove_task() - ç§»é™¤ä»»å‹™
- âœ… kill_task() - æ®ºæ­»ä»»å‹™
- âœ… pause_task() - æš«åœä»»å‹™
- âœ… start_task() - å•Ÿå‹•ä»»å‹™
- âœ… restart_task() - é‡å•Ÿä»»å‹™
- âœ… clean_tasks() - æ¸…ç†ä»»å‹™
- âœ… reset_queue() - é‡ç½®éšŠåˆ—

### API æ¥å£è¦†è“‹
- âœ… æ‰€æœ‰å¢å¼·çš„ add_task åƒæ•¸
- âœ… å®Œæ•´çš„ group ç®¡ç† REST API
- âœ… å®Œæ•´çš„ä»»å‹™æ§åˆ¶ REST API
- âœ… æ­£ç¢ºçš„ HTTP å‹•è©ä½¿ç”¨ (GET/POST/PUT/DELETE)

## ğŸ† æ¸¬è©¦çµ±è¨ˆ

| æ¸¬è©¦é¡åˆ¥   | æ¸¬è©¦é …ç›®æ•¸ | é€šéæ•¸ | å¤±æ•—æ•¸ | é€šéç‡   |
| ---------- | ---------- | ------ | ------ | -------- |
| ç•°æ­¥åŒ…è£å™¨ | 12         | 12     | 0      | 100%     |
| åŒæ­¥åŒ…è£å™¨ | 8          | 8      | 0      | 100%     |
| API æ¥å£   | 6          | 6      | 0      | 100%     |
| **ç¸½è¨ˆ**   | **26**     | **26** | **0**  | **100%** |

## ğŸ“ ç¸½çµ

âœ… **æ‰€æœ‰æ–°åŠŸèƒ½éƒ½å·²æˆåŠŸå¯¦ç¾ä¸¦é€šéæ¸¬è©¦**

1. **å®Œæ•´åŠŸèƒ½å¯¦ç¾**: æ”¯æŒäº† Pueue CLI çš„æ‰€æœ‰ä¸»è¦åŠŸèƒ½
2. **ä¸‰å±¤æ¥å£çµ±ä¸€**: ç•°æ­¥ã€åŒæ­¥ã€HTTP API ä¿æŒä¸€è‡´
3. **éŒ¯èª¤è™•ç†å®Œå–„**: æ‰€æœ‰éŒ¯èª¤éƒ½æœ‰é©ç•¶çš„è™•ç†å’Œåé¥‹
4. **é¡å‹å®‰å…¨**: ä½¿ç”¨ Pydantic ç¢ºä¿æ•¸æ“šçµæ§‹çš„æ­£ç¢ºæ€§
5. **å‘å¾Œå…¼å®¹**: ä¿æŒèˆ‡ç¾æœ‰ä»£ç¢¼çš„å®Œå…¨å…¼å®¹

PueueWrapper ç¾åœ¨æä¾›äº†ä¸€å€‹å®Œæ•´ã€å¼·å¤§ä¸”æ˜“ç”¨çš„ Pueue ä»»å‹™éšŠåˆ—ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼ğŸ‰
